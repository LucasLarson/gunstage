gunstage
--------

ğŸ”« `git unstage` as a service

https://github.com/LucasLarson/gunstage/actions?query=workflow:Super-Linter[image:https://img.shields.io/github/workflow/status/LucasLarson/gunstage/Super-Linter?logo=GitHub&label=Super-Linter[GitHub
Super-Linter]]
https://github.com/LucasLarson/gunstage/blob/main/license.adoc[image:https://img.shields.io/badge/license-GPLP-blue[GPLP,title="GNU
General Public License for Pedants"]]

What
~~~~
There are at least nine ways to unstage files in a Git&nbsp;repository.
Remembering which versions of Git support which syntax, under which
circumstances, reduced my productivity enough to publish this software
in&nbsp;response.

This is a command-line shell plugin for undoing `gitÂ add`. Too many
staged&nbsp;files? Canâ€™t remember if itâ€™s `gitÂ resetÂ HEAD` or
`gitÂ restoreÂ --stagedÂ --`? Just remember `gunstage` or `gitÂ unstage`.

If you donâ€™t want to unstage everything, more granular control
is&nbsp;available. `gunstage` works exactly as you would expect it to as it
performs the opposite of `gitÂ add`. You can unstage directories and
specific files in as few commands as youâ€™d like:
`gunstageÂ file1.txtÂ file2.txtÂ directory/`.

Why
~~~
There is no `gitÂ unstage` command packaged as part of Gitâ€™s
default&nbsp;tooling. While `gitÂ restoreÂ --staged` often performs the task,
itâ€™s not an obvious formula based on Gitâ€™s other&nbsp;commands.
`gitÂ restoreÂ --staged` is also&nbsp;unreliable, having
https://web.archive.org/web/20201214132901id_/github.blog/2019-08-16-highlights-from-git-2-23/#experimental-alternatives-for-git-checkout[entered
Gitâ€™s vocabulary in&nbsp;2019^], after some&nbsp;14 years of releases
without&nbsp;it. Many older releases remain in the wild and `gitÂ restore`
causes them to fail and choke. This software gracefully and silently accounts
for those situations by always sending the syntax that Git used from 2005 until
2019: `gitÂ reset`.

Instead of keeping up with the latest incarnation of Git, whose manual says
`gitÂ restore` â€œIS EXPERIMENTALâ€ and â€œTHE BEHAVIOR MAY CHANGEâ€ (emphasis
https://git-scm.com/docs/git-restore/2.30.0#_description[in original^]), you
can let this script do the remembering for&nbsp;you.

MinutiÃ¦ of the pedantic and querulous variety
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To unstage content in a Git repository&nbsp;â€“ that is, to undo a
`gitÂ add`&nbsp;â€“ you must remember https://stackoverflow.com/q/58003030[which
commands^] are still in use out of the many Iâ€™m aware of having been
recommended so&nbsp;far:

1. `git restore --staged` (https://stackoverflow.com/a/16044987[source^]),
1. `git reset HEAD` (https://stackoverflow.com/a/6790291[source^]),
1. `git reset -q HEAD --` (https://github.com/gggritso/gggritso.com/blob/a07b620/_posts/2015-08-23-human-git-aliases.md#L45[source^] (https://news.ycombinator.com/item?id=17987033#17987696[via^]))
1. `git reset` (https://stackoverflow.com/a/6790285[source^]),
1. `git restore --staged --` (https://github.com/iain/dotfiles/commit/4c8f8cf7b849d723cbd0e029457dd24c42ea6263[source^]),
1. `git reset HEAD --` (https://stackoverflow.com/a/5798967[source^]),
1. `git rm --cached` (https://stackoverflow.com/a/5798967[source^]),
1. `git reset --` (https://stackoverflow.com/a/6919257[source^]), and&nbsp;even
1. `git rm --cached --Â # ffs` (https://stackoverflow.com/a/30231316[source^]).

Next, you must be aware of repository&nbsp;context: if the repository is new
and no commit has occurred yet, then `gitÂ restoreÂ --staged` wonâ€™t&nbsp;work,
but `gunstage`&nbsp;will.

.Enter
[source,zsh]
-----------------
gunstage # ğŸ”« git unstage as aÂ service
git unstage # ğŸ”« it just works!
-----------------
Its name is an abbreviation and portmanteau of `gitÂ unstage` arising by
analog from
https://github.com/ohmyzsh/ohmyzsh/blob/c99f3c50fa46a93be28be88632889404fff3b958/plugins/git/README.md#aliases[Oh&nbsp;My&nbsp;Zshâ€™s
other Git&nbsp;aliases^].

How
~~~
The scripts are written in Bourne shell-flavored, KornShell- and Zsh-compatible
Bash, which is masquerading as Z&nbsp;shell with a `.zsh` filename extension so
Oh&nbsp;My&nbsp;Zsh recognizes it as a plugin.

Requirements
~~~~~~~~~~~~
* https://github.com/zsh-users/zsh/tree/zsh-5.8[Zsh&nbsp;5.8^] (or
  https://github.com/att/ast/tree/ksh93u[Ksh&nbsp;93^] (or
  https://git.sv.gnu.org/cgit/bash.git/commit/?h=bash-5.0[Bash&nbsp;5.0^])),
  and
* https://github.com/git/git/tree/v2.17.0[Git&nbsp;2.17^].

Testing
~~~~~~~
I tested `gunstage` atop Zsh&nbsp;5.8 and Bash&nbsp;3.2 using&nbsp;Git:

* 2.17 on Ubuntu&nbsp;18.04,
* 2.20 on Debian&nbsp;9.12,
* 2.28, 2.29, and 2.30 on macOS&nbsp;11.0 and Alpine&nbsp;3.11 and&nbsp;3.12,
  and

From macOS, I use https://github.com/gnachman/iTerm2[iTerm2^]; from iOS, I
use&nbsp;https://github.com/ish-app/ish[iSH^].
